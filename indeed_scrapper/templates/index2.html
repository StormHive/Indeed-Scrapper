<!DOCTYPE html>
<html lang="en">

<head>
    {% load static %}
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
        crossorigin="anonymous"></script>
    <link rel="stylesheet" href="{% static 'css/styles2.css' %}">
    <script src="{% static 'js/script.js' %}"></script>
    <title>Indeed</title>
</head>

<body>
    <div class="loader-container" id="loaderContainer">
        <div class="loader">
            <span></span>
            <span></span>
            <span></span>
            <span></span>
            <span></span>
            <span></span>
            <span></span>
            <span></span>
            <span></span>
            <span></span>
            <span></span>
            <span></span>
        </div>
    </div>
    <nav class="et-hero-tabs">
        <a href="https://www.allcollarrecruiting.com/">
            <img src="{% static 'images/logo-removebg-preview.png' %}"
                style="width: 40%; aspect-ratio: 2/2 ; object-fit: contain; margin: 5px;" alt="All Collar Recruiting">
        </a>
    </nav>
    <div class="container-fluid mt-5 mb-5 d-flex justify-content-center">
        <div class="container-fluid row">
            <div class="col-lg-5 left-main-cont rounded-left">
                <div class="container-fluid text-center mb-5 mt-3">
                    <h1>Indeed</h1>
                </div>
                <div class="container-fluid p-0">
                    <form action="">
                        <div class="container-fluid d-flex justify-content-left flex-column mb-4">
                            <label for="job_title" class="mb-2">
                                Enter the job
                            </label>
                            <input class="form-control searchbox mb-2" name="job_title" style="padding: 10px 15px;"
                                type="text" placeholder="Job title" required>
                        </div>

                        <div class="container-fluid d-flex justify-content-left flex-column mb-4">
                            <label for="job_title" class="mb-2">
                                Add Company
                            </label>
                            <input class="form-control searchbox mb-2" name="company" style="padding: 10px 15px;"
                                type="text" placeholder="Company">
                        </div>

                        <div class="container-fluid">
                            <div class="container-fluid header p-0">
                                <h2>Filters</h2>
                            </div>

                            <div class="container-fluid filter-list-div bg-white p-3 rounded">
                                <div class="row">
                                    <div class="col-lg-6 p-3 custom-select">
                                        <select class="form-select custom-dropdown py-3 " name="job_date" id="">
                                            <option value="" selected> Date Job posted</option>
                                            <option value="Last 24 hours">Last 24 hours</option>
                                            <option value="Last 3 days">Last 3 days</option>
                                            <option value="Last 7 days">Last 7 days</option>
                                            <option value="Last 14 days">Last 14 days</option>
                                            <option value="Last 30 days">Last 30 days</option>
                                            <option value="Over 30 days">Over 30 days</option>

                                        </select>
                                    </div>
                                    <div class="col-lg-6 p-3 custom-select">
                                        <select class="form-select custom-dropdown py-3 " name="job_type" id="">
                                            <option value="" selected>Job Type</option>
                                            <option value="Full-time">Full time</option>
                                            <option value="Part-time">Part time</option>
                                            <option value="Contract">Contract</option>
                                            <option value="Temporary">Temporary</option>
                                            <option value="Remote">Remote</option>
                                            <option value="Hybrid">Hybrid</option>
                                        </select>
                                    </div>
                                    <div class="col-lg-6 p-3 custom-select">
                                        <select class="form-select custom-dropdown py-3 " name="state" id="">
                                            <option value="" selected>Select State</option>
                                            <option value="Alabama">Alabama</option>
                                            <option value="Alaska">Alaska</option>
                                            <option value="Arizona">Arizona</option>
                                            <option value="Arkansas">Arkansas</option>
                                            <option value="California">California</option>
                                            <option value="Colorado">Colorado</option>
                                            <option value="Connecticut">Connecticut</option>
                                            <option value="Delaware">Delaware</option>
                                            <option value="Florida">Florida</option>
                                            <option value="Georgia">Georgia</option>
                                            <option value="Hawaii">Hawaii</option>
                                            <option value="Idaho">Idaho</option>
                                            <option value="Illinois">Illinois</option>
                                            <option value="Indiana">Indiana</option>
                                            <option value="Iowa">Iowa</option>
                                            <option value="Kansas">Kansas</option>
                                            <option value="Kentucky">Kentucky</option>
                                            <option value="Louisiana">Louisiana</option>
                                            <option value="Maine">Maine</option>
                                            <option value="Maryland">Maryland</option>
                                            <option value="Massachusetts">Massachusetts</option>
                                            <option value="Michigan">Michigan</option>
                                            <option value="Minnesota">Minnesota</option>
                                            <option value="Mississippi">Mississippi</option>
                                            <option value="Missouri">Missouri</option>
                                            <option value="Montana">Montana</option>
                                            <option value="Nebraska">Nebraska</option>
                                            <option value="Nevada">Nevada</option>
                                            <option value="New Hampshire">New Hampshire</option>
                                            <option value="New Jersey">New Jersey</option>
                                            <option value="New Mexico">New Mexico</option>
                                            <option value="New York">New York</option>
                                            <option value="North Carolina">North Carolina</option>
                                            <option value="North Dakota">North Dakota</option>
                                            <option value="Ohio">Ohio</option>
                                            <option value="Oklahoma">Oklahoma</option>
                                            <option value="Oregon">Oregon</option>
                                            <option value="Pennsylvania">Pennsylvania</option>
                                            <option value="Rhode Island">Rhode Island</option>
                                            <option value="South Carolina">South Carolina</option>
                                            <option value="South Dakota">South Dakota</option>
                                            <option value="Tennessee">Tennessee</option>
                                            <option value="Texas">Texas</option>
                                            <option value="Utah">Utah</option>
                                            <option value="Vermont">Vermont</option>
                                            <option value="Virginia">Virginia</option>
                                            <option value="Washington">Washington</option>
                                            <option value="West Virginia">West Virginia</option>
                                            <option value="Wisconsin">Wisconsin</option>
                                            <option value="Wyoming">Wyoming</option>
                                        </select>
                                    </div>
                                    <div class="col-lg-6 p-3 custom-select">
                                        <select class="form-select custom-dropdown py-3 " name="posted_by" id="">
                                            <option value="" selected>Posted By
                                            </option>
                                            <option value="Employer">Employer</option>
                                            <option value="Staffing agency">Staffing agency</option>
                                        </select>

                                    </div>
                                    <!-- <div class="col-lg-6 p-3 custom-select">
                                        <select class="form-select custom-dropdown py-3 " name="experience_levele"
                                            id="">
                                            <option value="" selected>Experience level</option>
                                            <option value="Entry level">Entry level</option>
                                            <option value="Mid level">Mid level</option>
                                            <option value="Senior level">Senior level</option>
                                            <option value="No experience required">No experience required</option>
                                        </select>
                                    </div>
                                    <div class="col-lg-6 p-3 custom-select">
                                        <select class="form-select custom-dropdown py-3 " name="education" id="">
                                            <option value="" selected>Education</option>
                                            <option value="High school degree">High school degree</option>
                                            <option value="Associate degree">Associate degree</option>
                                            <option value="Bachelors degree">Bachelors degree</option>
                                            <option value="Masters degree">Masters degree</option>
                                            <option value="Doctoral degree">Doctoral degree</option>
                                        </select>
                                    </div> -->

                                </div>
                                <div class="row mt-3" style="align-items: center;">
                                    <div class="col-lg-6 p-3 custom-select">
                                        <select class="form-select custom-dropdown py-3 " name="pay" id="">
                                            <option value="" selected>Pay
                                            </option>
                                            <option value="hour">Per hour</option>
                                            <option value="year">Per Year</option>
                                        </select>
                                    </div>
                                    <div class="col-lg-6 container-fluid d-flex justify-content-between">
                                        <label for="min_pay" class="mb-1">
                                            Min. Pay
                                        </label>
                                        <input class="form-control searchbox mb-2 rounded" name="minpay"
                                            style="padding: 10px 15px; text-align: center;" type="text"
                                            placeholder="Minimum Pay">
                                    </div>
                                </div>
                                <div class="row mt-3">

                                    <div class="col-lg-6 p-3 custom-select">
                                        <select class="form-select custom-dropdown py-3" name="keyword">
                                            <option value="">Keywords</option>
                                            <option value="urgently hiring">urgently hiring</option>
                                            <option value="hiring multiple candidates">hiring multiple candidates</option>
                                            <option value="bonus">bonus</option>
                                        </select>
                                    </div>
                                </div>

                                <div class="container-fluid d-flex justify-content-left flex-column mb-4">
                                    <label for="job_title" class="mb-2">
                                        Add More Keywords
                                    </label>
                                    <textarea class="form-control searchbox mb-2" name="more_keywords" type="text"
                                        placeholder="Keywords(Seperate Every Keyword with a comma ',' e.g. Bouns, Required)"></textarea>
                                </div>

                                <div class="container-fluid d-flex justify-content-left flex-column mb-4">
                                    <label for="job_title" class="mb-2">
                                        Add Exclusions
                                    </label>
                                    <textarea class="form-control searchbox mb-2" name="exclusives" type="text"
                                        placeholder="Exclude(Seperate Every Exclusion with a comma ',' e.g. School, College)"></textarea>
                                </div>

                            </div>
                            <div class="search-button" onclick="sendRequest();">
                                <div>
                                    <button href="#" id="searchButton" style="border: 0px;">
                                        <span></span>
                                        <span></span>
                                        <span></span>
                                        <span></span>
                                        Search
                                    </button>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>

            </div>
            <div class="col-lg-7 right-main-cont rounded-right" style="text-align: left;">
                <div class="container-fluid mt-3">
                    <h1>Results</h1>
                </div>
                <div class="container-fluid table-cont mt-5 p-4" style="overflow: scroll;">

                    <table class="table table-striped" id="jobDetailsTable">
                        <thead>
                            <tr>
                                <th scope="col">Date Posted</th>
                                <th scope="col">Job Title</th>
                                <th scope="col">Company Name</th>
                                <th scope="col">Indeed Link</th>
                                <th scope="col">Location</th>
                                <th scope="col">Pay</th>
                                <th scope="col">Type</th>
                            </tr>
                        </thead>
                        <tbody>

                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    <script>
        function setmaxRange(value) {
            document.getElementById("maximum_range").innerHTML = "$" + value
        }
        function setminRange(value) {
            document.getElementById("manimum_range").innerHTML = "$" + value
        }
        function showLoader() {
            document.getElementById("loaderContainer").style.display = "flex";
        }
    </script>

    <script>
        function populateData(job_details) {
            const table = document.getElementById('jobDetailsTable');

            job_details.forEach(job => {
                // Create a new table row
                const row = table.insertRow();

                // Insert cells for each job detail
                const postedAtCell = row.insertCell();
                const jobTitleCell = row.insertCell();
                const companyLocationCell = row.insertCell();
                const Pay = row.insertCell();
                const type = row.insertCell();
                const exp = row.insertCell();
                const education = row.insertCell();
                const companyLocation = row.insertCell();
                var company_link = document.createElement("a");
                company_link.href = job.company_link;
                company_link.target = "_blank";
                company_link.textContent = job.company_link;
                companyLocationCell.appendChild(company_link);


                // Set the content of each cell
                postedAtCell.textContent = job.posted_at;
                jobTitleCell.textContent = job.job_title;

                type.textContent = job.job_type;
                Pay.textContent = job.job_salary;
                exp.textContent = job.job_exp_level;
                education.textContent = job.job_education_level;
                companyLocation.textContent = job.company_location;


                // Add more cells for other job details as needed
            });

        }

        function sendRequest() {
            const form = document.querySelector('form');


            // Define a function to handle form submission
            function handleSubmit(event) {
                event.preventDefault();

                const formData = new FormData(form);
                const jsonObject = {};
                formData.forEach(function (value, key) {
                    jsonObject[key] = value;
                });
                console.log(jsonObject);

                const url = 'http://127.0.0.1:8000/job_scrapper/';

                document.getElementById("loaderContainer").style.display = "flex";
                fetch(url, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(jsonObject)
                })
                    .then(response => {
                        if (!response.ok) {
                            throw new Error('Network response was not ok');
                        }
                        return response.json();
                    })
                    .then(data => {
                        console.log('Success:', data);
                        populateData(data.job_details);
                        document.getElementById("loaderContainer").style.display = "none";
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        document.getElementById("loaderContainer").style.display = "none";
                    });


                // Remove the event listener to prevent further submissions
                form.removeEventListener('submit', handleSubmit);
            }

            // Add event listener to the form
            form.addEventListener('submit', handleSubmit);
        }

    </script>

    <script>
        var x, i, j, l, ll, selElmnt, a, b, c;
        x = document.getElementsByClassName("custom-select");
        l = x.length;
        for (i = 0; i < l; i++) {
            selElmnt = x[i].getElementsByTagName("select")[0];
            ll = selElmnt.length;
            a = document.createElement("DIV");
            a.setAttribute("class", "select-selected");
            a.innerHTML = selElmnt.options[selElmnt.selectedIndex].innerHTML;
            x[i].appendChild(a);
            b = document.createElement("DIV");
            b.setAttribute("class", "select-items select-hide");
            for (j = 1; j < ll; j++) {
                c = document.createElement("DIV");
                c.innerHTML = selElmnt.options[j].innerHTML;
                c.addEventListener("click", function (e) {
                    var y, i, k, s, h, sl, yl;
                    s = this.parentNode.parentNode.getElementsByTagName("select")[0];
                    sl = s.length;
                    h = this.parentNode.previousSibling;
                    for (i = 0; i < sl; i++) {
                        if (s.options[i].innerHTML == this.innerHTML) {
                            s.selectedIndex = i;
                            h.innerHTML = this.innerHTML;
                            y = this.parentNode.getElementsByClassName("same-as-selected");
                            yl = y.length;
                            for (k = 0; k < yl; k++) {
                                y[k].removeAttribute("class");
                            }
                            this.setAttribute("class", "same-as-selected");
                            break;
                        }
                    }
                    h.click();
                });
                b.appendChild(c);
            }
            x[i].appendChild(b);
            a.addEventListener("click", function (e) {
                e.stopPropagation();
                closeAllSelect(this);
                this.nextSibling.classList.toggle("select-hide");
                this.classList.toggle("select-arrow-active");
            });
        }
        function closeAllSelect(elmnt) {
            var x, y, i, xl, yl, arrNo = [];
            x = document.getElementsByClassName("select-items");
            y = document.getElementsByClassName("select-selected");
            xl = x.length;
            yl = y.length;
            for (i = 0; i < yl; i++) {
                if (elmnt == y[i]) {
                    arrNo.push(i)
                } else {
                    y[i].classList.remove("select-arrow-active");
                }
            }
            for (i = 0; i < xl; i++) {
                if (arrNo.indexOf(i)) {
                    x[i].classList.add("select-hide");
                }
            }
        }
        document.addEventListener("click", closeAllSelect);
    </script>
</body>

</html>