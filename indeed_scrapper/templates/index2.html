<!DOCTYPE html>
<html lang="en">

<head>
    {% load static %}
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
        crossorigin="anonymous"></script>
    <link rel="stylesheet" href="{% static 'css/styles2.css' %}">
    <script src="{% static 'js/script.js' %}"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.1.0-beta.1/css/select2.min.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.1.0-beta.1/js/select2.min.js"></script>

    <title>Indeed</title>
</head>

<body>
    <div class="loader-container" id="loaderContainer">
        <div class="loader">
            <span></span>
            <span></span>
            <span></span>
            <span></span>
            <span></span>
            <span></span>
            <span></span>
            <span></span>
            <span></span>
            <span></span>
            <span></span>
            <span></span>
        </div>
    </div>
    <nav class="et-hero-tabs">
        <a href="https://www.allcollarrecruiting.com/">
            <img src="{% static 'images/logo-removebg-preview.png' %}"
                style="width: 40%; aspect-ratio: 2/2 ; object-fit: contain; margin: 5px;" alt="All Collar Recruiting">
        </a>
    </nav>
    <div class="container-fluid mt-5 mb-5 d-flex justify-content-center">
        <div class="container-fluid row">
            <div class="col-lg-5 left-main-cont rounded-left">
                <div class="container-fluid text-center mb-5 mt-3">
                    <h1>Indeed</h1>
                </div>
                <div class="container-fluid p-0">
                    <form action="">
                        <div class="container-fluid d-flex justify-content-left flex-column mb-4">
                            <label for="job_title" class="mb-2">
                                Job Title
                            </label>
                            <input class="form-control searchbox mb-2" name="job_title" style="padding: 10px 15px;"
                                type="text" placeholder="Search Job title" required>
                        </div>

                        <div class="container-fluid d-flex justify-content-left flex-column mb-4">
                            <label for="job_title" class="mb-2">
                                Company
                            </label>
                            <input class="form-control searchbox mb-2" name="Add company" style="padding: 10px 15px;"
                                type="text" placeholder="Search Company">
                        </div>

                        <div class="container-fluid">
                            <div class="container-fluid header p-0">
                                <h2>Filters</h2>
                            </div>

                            <div class="container-fluid filter-list-div bg-white p-3 rounded">
                                <div class="row px-1 py-8">
                                    <div class="col-lg-6 p-3 custom-select">
                                        <label class="lh">Date Job Posted</label>

                                        <select class="form-select  py-3 " name="job_date" id="">
                                            <option value="" selected>Select Date Job Posted</option>
                                            <option value="Last 24 hours">Last 24 hours</option>
                                            <option value="Last 3 days">Last 3 days</option>
                                            <option value="Last 7 days">Last 7 days</option>
                                            <option value="Last 14 days">Last 14 days</option>
                                            <option value="Last 30 days">Last 30 days</option>
                                            <option value="Over 30 days">Over 30 days</option>

                                        </select>
                                    </div>
                                    <div class="col-lg-6 p-3 custom-select">
                                        <label class="lh">State</label>
                                        <select class="form-select  py-3 " name="state" id="stateSelect">
                                            <option value="" selected>Select State</option>
                                            <option value="AL">Alabama, AL</option>
                                            <option value="AK">Alaska, AK</option>
                                            <option value="AZ">Arizona, AZ</option>
                                            <option value="AR">Arkansas, AR</option>
                                            <option value="CA">California, CA</option>
                                            <option value="CO">Colorado, CO</option>
                                            <option value="CT">Connecticut, CT</option>
                                            <option value="DE">Delaware, DE</option>
                                            <option value="FL">Florida, FL</option>
                                            <option value="GA">Georgia, GA</option>
                                            <option value="HI">Hawaii, HI</option>
                                            <option value="ID">Idaho, ID</option>
                                            <option value="IL">Illinois, IL</option>
                                            <option value="IN">Indiana, IN</option>
                                            <option value="IA">Iowa, IA</option>
                                            <option value="KS">Kansas, KS</option>
                                            <option value="KY">Kentucky, KY</option>
                                            <option value="LA">Louisiana, LA</option>
                                            <option value="ME">Maine, ME</option>
                                            <option value="MD">Maryland, MD</option>
                                            <option value="MA">Massachusetts, MA</option>
                                            <option value="MI">Michigan, MI</option>
                                            <option value="MN">Minnesota, MN</option>
                                            <option value="MS">Mississippi, MS</option>
                                            <option value="MO">Missouri, MO</option>
                                            <option value="MT">Montana, MT</option>
                                            <option value="NE">Nebraska, NE</option>
                                            <option value="NV">Nevada, NV</option>
                                            <option value="NH">New Hampshire, NH</option>
                                            <option value="NJ">New Jersey, NJ</option>
                                            <option value="NM">New Mexico, NM</option>
                                            <option value="NY">New York, NY</option>
                                            <option value="NC">North Carolina, NC</option>
                                            <option value="ND">North Dakota, ND</option>
                                            <option value="OH">Ohio, OH</option>
                                            <option value="OK">Oklahoma, OK</option>
                                            <option value="OR">Oregon, OR</option>
                                            <option value="PA">Pennsylvania, PA</option>
                                            <option value="RI">Rhode Island, RI</option>
                                            <option value="SC">South Carolina, SC</option>
                                            <option value="SD">South Dakota, SD</option>
                                            <option value="TN">Tennessee, TN</option>
                                            <option value="TX">Texas, TX</option>
                                            <option value="UT">Utah, UT</option>
                                            <option value="VT">Vermont, VT</option>
                                            <option value="VA">Virginia, VA</option>
                                            <option value="WA">Washington, WA</option>
                                            <option value="WV">West Virginia, WV</option>
                                            <option value="WI">Wisconsin, WI</option>
                                            <option value="WY">Wyoming, WY</option>
                                        </select>
                                    </div>
                                    <div class="col-lg-6 p-3 custom-select">
                                        <label class="lh">Job Type</label>

                                        <select class="form-select py-3" name="job_type" id="">
                                            <option value="" selected>Select Job Type</option>
                                            <option value="Full-time">Full time</option>
                                            <option value="Part-time">Part time</option>
                                            <option value="Contract">Contract</option>
                                            <option value="Temporary">Temporary</option>
                                            <option value="Remote">Remote</option>
                                            <option value="Hybrid">Hybrid</option>
                                        </select>
                                    </div>

                                    <div class="col-lg-6 p-3 custom-select">
                                        <label class="lh">Posted By</label>

                                        <select class="form-select  py-3 " name="posted_by" id="">
                                            <option value="" selected>Select Posted By
                                            </option>
                                            <option value="Employer">Employer</option>
                                            <option value="Staffing agency">Staffing agency</option>
                                        </select>

                                    </div>

                                    <div class="col-lg-6 p-3 custom-select">
                                        <label class="lh">Experience Level</label>
                                        <select class="form-select  py-3 " name="experience_levele" id="">
                                            <option value="" selected>Select Experience level</option>
                                            <option value="Entry level">Entry level</option>
                                            <option value="Mid level">Mid level</option>
                                            <option value="Senior level">Senior level</option>
                                            <option value="No experience required">No experience required</option>
                                        </select>
                                    </div>
                                    <div class="col-lg-6 p-3 custom-select">
                                        <label class="lh">Education</label>
                                        <select class="form-select  py-3 " name="education" id="">
                                            <option value="" selected>Select Education</option>
                                            <option value="High school degree">High school degree</option>
                                            <option value="Associate degree">Associate degree</option>
                                            <option value="Bachelor's degree">Bachelor's degree</option>
                                            <option value="Master's degree">Master's degree</option>
                                            <option value="Doctoral degree">Doctoral degree</option>
                                        </select>
                                    </div>
                                    <div class="col-lg-6 p-3 custom-select">
                                        <label class="lh">Remote</label>
                                        <select class="form-select  py-3 " name="remote" id="">
                                            <option value="" selected>Select Remote
                                            </option>
                                            <option value="Hybrid Work">Hybrid Work</option>
                                            <option value="Remote">Remote</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="row mt-3" style="align-items: center;">
                                    <label class="lh" style="margin-left: 5px;">Pay</label>
                                    <div class="col-lg-5 p-3 custom-select">
                                        <select class="form-select  py-3 " name="pay" id="">
                                            <option value="" selected>Select Pay type
                                            </option>
                                            <option value="hour">Per hour</option>
                                            <option value="year">Per year</option>
                                        </select>
                                    </div>
                                    <div class="col-lg-7 container-fluid d-flex justify-content-between">
                                        <label for="min_pay" class=" lh">
                                            Min. Pay ($)
                                        </label>
                                        
                                        <input class="form-control searchbox mb-2 rounded" name="minpay"
                                            style="text-align: center;" type="text" placeholder="Type Minimum Pay">
                                    </div>
                                </div>
                                <div class="row mt-3">

                                    <div class="col-lg-6 p-3 custom-select">
                                        <label class="lh">Keywords</label>

                                        <select class="form-select  py-3" name="keyword">
                                            <option value="">Select Keywords</option>
                                            <option value="urgently hiring">urgently hiring</option>
                                            <option value="hiring multiple candidates">hiring multiple candidates
                                            </option>
                                            <option value="bonus">bonus</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            <div class="container-fluid d-flex justify-content-left flex-column mb-4 mt-5">
                                <label for="more_keywords" class="mb-2">
                                    Add More Keywords
                                </label>
                                <textarea class="form-control searchbox mb-2" name="more_keywords" type="text"
                                    placeholder="Keywords(Separate Every Keyword with a comma ',' e.g. Bouns, Required)"></textarea>
                            </div>

                            <div class="container-fluid d-flex justify-content-left flex-column mb-4">
                                <label for="more_exclusions" class="mb-2">
                                    Add Exclusions
                                </label>
                                <textarea class="form-control searchbox mb-2" name="exclusives" type="text"
                                    placeholder="Exclude(Separate Every Exclusion with a comma ',' e.g. School, College)"></textarea>
                            </div>


                            <div class="search-button" onclick="sendRequest();">
                                <div>
                                    <button href="#" id="searchButton" style="border: 0px;">
                                        <span></span>
                                        <span></span>
                                        <span></span>
                                        <span></span>
                                        Search
                                    </button>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>

            </div>
            <div class="col-lg-7 right-main-cont rounded-right" style="text-align: left;">
                <div class="container-fluid mt-3">
                    <h1>Results</h1>
                </div>
                <div class="container-fluid table-cont mt-5 p-4" style="overflow: scroll;">

                    <table class="table table-striped" id="jobDetailsTable">
                        <thead>
                            <tr>
                                <th scope="col">Date Posted</th>
                                <th scope="col">Job Title</th>
                                <th scope="col">Company Name</th>
                                <th scope="col">Indeed Link</th>
                                <th scope="col">Location</th>
                                <th scope="col">Pay</th>
                                <th scope="col">Job Type</th>
                                <th scope="col">Experience Level</th>
                                <th scope="col">Education</th>
                            </tr>
                        </thead>
                        <tbody>

                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    <script>
        function setmaxRange(value) {
            document.getElementById("maximum_range").innerHTML = "$" + value
        }
        function setminRange(value) {
            document.getElementById("manimum_range").innerHTML = "$" + value
        }
        function showLoader() {
            document.getElementById("loaderContainer").style.display = "flex";
        }
    </script>

    <script>
        function populateData(job_details) {
            const table = document.getElementById('jobDetailsTable');

            job_details.forEach(job => {
                // Create a new table row
                const row = table.insertRow();

                // Insert cells for each job detail
                const postedAtCell = row.insertCell();
                const jobTitleCell = row.insertCell();
                const companyLocationCell = row.insertCell();
                const Pay = row.insertCell();
                const type = row.insertCell();
                const exp = row.insertCell();
                const education = row.insertCell();
                const companyLocation = row.insertCell();
                var company_link = document.createElement("a");
                company_link.href = job.company_link;
                company_link.target = "_blank";
                company_link.textContent = job.company_link;
                companyLocationCell.appendChild(company_link);


                // Set the content of each cell
                postedAtCell.textContent = job.posted_at;
                jobTitleCell.textContent = job.job_title;

                type.textContent = job.job_type;
                Pay.textContent = job.job_salary;
                exp.textContent = job.job_exp_level;
                education.textContent = job.job_education_level;
                companyLocation.textContent = job.company_location;


                // Add more cells for other job details as needed
            });

        }
        $(document).ready(function () {
            $('#stateSelect').select2({
                dropdownCssClass: "scrollable-dropdown"
            });
        });

        function sendRequest() {
            const form = document.querySelector('form');


            // Define a function to handle form submission
            function handleSubmit(event) {
                event.preventDefault();

                const formData = new FormData(form);
                const jsonObject = {};
                formData.forEach(function (value, key) {
                    jsonObject[key] = value;
                });
                console.log(jsonObject);

                const url = 'http://127.0.0.1:8000/job_scrapper/';

                document.getElementById("loaderContainer").style.display = "flex";
                fetch(url, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(jsonObject)
                })
                    .then(response => {
                        if (!response.ok) {
                            throw new Error('Network response was not ok');
                        }
                        return response.json();
                    })
                    .then(data => {
                        console.log('Success:', data);
                        populateData(data.job_details);
                        document.getElementById("loaderContainer").style.display = "none";
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        document.getElementById("loaderContainer").style.display = "none";
                    });


                // Remove the event listener to prevent further submissions
                form.removeEventListener('submit', handleSubmit);
            }

            // Add event listener to the form
            form.addEventListener('submit', handleSubmit);
        }

    </script>
    <script>
        var x, i, j, l, ll, selElmnt, a, b, c;
        x = document.getElementsByClassName("custom-select");
        l = x.length;
        for (i = 0; i < l; i++) {
            selElmnt = x[i].getElementsByTagName("select")[0];
            ll = selElmnt.length;
            a = document.createElement("DIV");
            a.setAttribute("class", "select-selected");
            a.innerHTML = selElmnt.options[selElmnt.selectedIndex].innerHTML;
            x[i].appendChild(a);
            b = document.createElement("DIV");
            b.setAttribute("class", "select-items select-hide");
            for (j = 1; j < ll; j++) {
                c = document.createElement("DIV");
                c.innerHTML = selElmnt.options[j].innerHTML;
                c.addEventListener("click", function (e) {
                    var y, i, k, s, h, sl, yl;
                    s = this.parentNode.parentNode.getElementsByTagName("select")[0];
                    sl = s.length;
                    h = this.parentNode.previousSibling;
                    for (i = 0; i < sl; i++) {
                        if (s.options[i].innerHTML == this.innerHTML) {
                            s.selectedIndex = i;
                            h.innerHTML = this.innerHTML;
                            y = this.parentNode.getElementsByClassName("same-as-selected");
                            yl = y.length;
                            for (k = 0; k < yl; k++) {
                                y[k].removeAttribute("class");
                            }
                            this.setAttribute("class", "same-as-selected");
                            break;
                        }
                    }
                    h.click();
                });
                b.appendChild(c);
            }
            x[i].appendChild(b);
            a.addEventListener("click", function (e) {
                e.stopPropagation();
                closeAllSelect(this);
                this.nextSibling.classList.toggle("select-hide");
                this.classList.toggle("select-arrow-active");
            });
        }
        function closeAllSelect(elmnt) {
            var x, y, i, xl, yl, arrNo = [];
            x = document.getElementsByClassName("select-items");
            y = document.getElementsByClassName("select-selected");
            xl = x.length;
            yl = y.length;
            for (i = 0; i < yl; i++) {
                if (elmnt == y[i]) {
                    arrNo.push(i)
                } else {
                    y[i].classList.remove("select-arrow-active");
                }
            }
            for (i = 0; i < xl; i++) {
                if (arrNo.indexOf(i)) {
                    x[i].classList.add("select-hide");
                }
            }
        }
        document.addEventListener("click", closeAllSelect);
    </script>
</body>

</html>