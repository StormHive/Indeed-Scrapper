<!DOCTYPE html>
<html lang="en">

<head>
    {% load static %}
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
        crossorigin="anonymous"></script>
    <link rel="stylesheet" href="{% static 'css/styles2.css' %}">
    <script src="{% static 'js/script.js' %}"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.1.0-beta.1/css/select2.min.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.1.0-beta.1/js/select2.min.js"></script>

    <title>Job Finder</title>
</head>

<body>
    <div class="loader-container" id="loaderContainer">
        <div class="loader">
            <span></span>
            <span></span>
            <span></span>
            <span></span>
            <span></span>
            <span></span>
            <span></span>
            <span></span>
            <span></span>
            <span></span>
            <span></span>
            <span></span>
        </div>
    </div>
    <nav class="et-hero-tabs">
        <a href="https://www.allcollarrecruiting.com/">
            <img src="{% static 'images/logo-removebg-preview.png' %}"
                style="width: 40%; aspect-ratio: 2/2 ; object-fit: contain; margin: 5px;" alt="All Collar Recruiting">
        </a>
    </nav>
    <div class="container-fluid mt-5 mb-5 d-flex justify-content-center">
        <div class="container-fluid row">
            <div class="col-lg-5 left-main-cont rounded-left">
                <div class="container-fluid text-center mb-5 mt-3">
                    <h1>Job Search</h1>
                </div>
                <div class="container-fluid p-0">
                    <form action="">
                        {% csrf_token %}
                        <div class="container-fluid d-flex justify-content-left flex-column mb-4">
                            <label for="job_title" class="mb-2">
                                Job Title
                            </label>
                            <input class="form-control searchbox mb-2" id="job_title_input" name="job_title"
                                style="padding: 10px 15px;" type="text" placeholder="Search Job title" required>
                        </div>

                        <div class="container-fluid d-flex justify-content-left flex-column mb-4">
                            <label for="job_title" class="mb-2">
                                Company
                            </label>
                            <input class="form-control searchbox mb-2" name="Add company" style="padding: 10px 15px;"
                                type="text" placeholder="Search Company">
                        </div>

                        <div class="container-fluid">
                            <div class="container-fluid header p-0">
                                <h2>Filters</h2>
                            </div>

                            <div class="container-fluid filter-list-div bg-white p-3 rounded">
                                <div class="row px-1 py-8">
                                    <div class="col-lg-6 p-3 custom-select">
                                        <label class="lh">Date Job Posted</label>

                                        <select class="form-select  py-3 " name="job_date" id="">
                                            <option value="" selected>Select Date Job Posted</option>
                                            <option value="Last 24 hours">Last 24 hours</option>
                                            <option value="Last 3 days">Last 3 days</option>
                                            <option value="Last 7 days">Last 7 days</option>
                                            <option value="Last 14 days">Last 14 days</option>
                                            <option value="Last 30 days">Last 30 days</option>
                                            <option value="Over 30 days">Over 30 days</option>
                                        </select>
                                    </div>
                                    <div class="col-lg-6 p-3 custom-select">
                                        <label class="lh">State</label>
                                        <select class="form-select  py-3 " name="location" id="stateSelect">
                                            <option value="" selected>Select State</option>
                                            <option value="Alabama,AL">Alabama, AL</option>
                                            <option value="Alaska,AK">Alaska, AK</option>
                                            <option value="Arizona,AZ">Arizona, AZ</option>
                                            <option value="Arkansas,AR">Arkansas, AR</option>
                                            <option value="California,CA">California, CA</option>
                                            <option value="Colorado,CO">Colorado, CO</option>
                                            <option value="Connecticut,CT">Connecticut, CT</option>
                                            <option value="Delaware,DE">Delaware, DE</option>
                                            <option value="Florida,FL">Florida, FL</option>
                                            <option value="Georgia,GA">Georgia, GA</option>
                                            <option value="Hawaii,HI">Hawaii, HI</option>
                                            <option value="Idaho,ID">Idaho, ID</option>
                                            <option value="Illinois,IL">Illinois, IL</option>
                                            <option value="Indiana,IN">Indiana, IN</option>
                                            <option value="Iowa,IA">Iowa, IA</option>
                                            <option value="Kansas,KS">Kansas, KS</option>
                                            <option value="Kentucky,KY">Kentucky, KY</option>
                                            <option value="Louisiana,LA">Louisiana, LA</option>
                                            <option value="Maine,ME">Maine, ME</option>
                                            <option value="Maryland,MD">Maryland, MD</option>
                                            <option value="Massachusetts,MA">Massachusetts, MA</option>
                                            <option value="Michigan,MI">Michigan, MI</option>
                                            <option value="Minnesota,MN">Minnesota, MN</option>
                                            <option value="Mississippi,MS">Mississippi, MS</option>
                                            <option value="Missouri,MO">Missouri, MO</option>
                                            <option value="Montana,MT">Montana, MT</option>
                                            <option value="Nebraska,NE">Nebraska, NE</option>
                                            <option value="Nevada,NV">Nevada, NV</option>
                                            <option value="New Hampshire,NH">New Hampshire, NH</option>
                                            <option value="New Jersey,NJ">New Jersey, NJ</option>
                                            <option value="New Mexico,NM">New Mexico, NM</option>
                                            <option value="New York,NY">New York, NY</option>
                                            <option value="North Carolina,NC">North Carolina, NC</option>
                                            <option value="North Dakota,ND">North Dakota, ND</option>
                                            <option value="Ohio,OH">Ohio, OH</option>
                                            <option value="Oklahoma,OK">Oklahoma, OK</option>
                                            <option value="Oregon,OR">Oregon, OR</option>
                                            <option value="Pennsylvania,PA">Pennsylvania, PA</option>
                                            <option value="Rhode Island,RI">Rhode Island, RI</option>
                                            <option value="South Carolina,SC">South Carolina, SC</option>
                                            <option value="South Dakota,SD">South Dakota, SD</option>
                                            <option value="Tennessee,TN">Tennessee, TN</option>
                                            <option value="Texas,TX">Texas, TX</option>
                                            <option value="Utah,UT">Utah, UT</option>
                                            <option value="Vermont,VT">Vermont, VT</option>
                                            <option value="Virginia,VA">Virginia, VA</option>
                                            <option value="Washington,WA">Washington, WA</option>
                                            <option value="West Virginia,WV">West Virginia, WV</option>
                                            <option value="Wisconsin,WI">Wisconsin, WI</option>
                                            <option value="Wyoming,WY">Wyoming, WY</option>
                                        </select>
                                    </div>
                                    <div class="col-lg-6 p-3 custom-select">
                                        <label class="lh">Job Type</label>

                                        <select class="form-select py-3" name="job_type" id="">
                                            <option value="" selected>Select Job Type</option>
                                            <option value="Full-time">Full time</option>
                                            <option value="Part-time">Part time</option>
                                            <option value="Contract">Contract</option>
                                            <option value="Temporary">Temporary</option>
                                            <option value="Remote">Remote</option>
                                            <option value="Hybrid">Hybrid</option>
                                        </select>
                                    </div>

                                    <div class="col-lg-6 p-3 custom-select">
                                        <label class="lh">Posted By</label>

                                        <select class="form-select  py-3 " name="posted_by" id="">
                                            <option value="" selected>Select Posted By
                                            </option>
                                            <option value="Employer">Employer</option>
                                            <option value="Staffing agency">Staffing agency</option>
                                        </select>

                                    </div>

                                    <div class="col-lg-6 p-3 custom-select">
                                        <label class="lh">Experience Level</label>
                                        <select class="form-select  py-3 " name="experience_level" id="">
                                            <option value="" selected>Select Experience level</option>
                                            <option value="Entry Level">Entry level</option>
                                            <option value="Mid Level">Mid level</option>
                                            <option value="Senior Level">Senior level</option>
                                            <option value="No Experience Required">No experience required</option>
                                        </select>
                                    </div>
                                    <div class="col-lg-6 p-3 custom-select">
                                        <label class="lh">Education</label>
                                        <select class="form-select  py-3 " name="education" id="">
                                            <option value="" selected>Select Education</option>
                                            <option value="High school degree">High school degree</option>
                                            <option value="Associate degree">Associate degree</option>
                                            <option value="Bachelor's degree">Bachelor's degree</option>
                                            <option value="Master's degree">Master's degree</option>
                                            <option value="Doctoral degree">Doctoral degree</option>
                                        </select>
                                    </div>
                                    <div class="col-lg-6 p-3 custom-select">
                                        <label class="lh">Remote</label>
                                        <select class="form-select  py-3 " name="remote" id="">
                                            <option value="" selected>Select Remote
                                            </option>
                                            <option value="Hybrid Work">Hybrid Work</option>
                                            <option value="Remote">Remote</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="row mt-3" style="align-items: center;">
                                    <label class="lh" style="margin-left: 5px;">Pay</label>
                                    <div class="col-lg-5 p-3 custom-select">
                                        <select class="form-select  py-3 " name="pay_type" id="">
                                            <option value="" selected>Select Pay type
                                            </option>
                                            <option value="hour">Per hour</option>
                                            <option value="year">Per year</option>
                                        </select>
                                    </div>
                                    <div class="col-lg-7 container-fluid d-flex justify-content-between">
                                        <label for="min_pay" class=" lh">
                                            Min. Pay ($)
                                        </label>

                                        <input class="form-control searchbox mb-2 rounded" name="minimum_salary"
                                            style="text-align: center;" type="text" placeholder="Type Minimum Pay">
                                    </div>
                                </div>
                                <div class="row mt-3">

                                    <div class="col-lg-6 p-3 custom-select">
                                        <label class="lh">Keywords</label>

                                        <select class="form-select  py-3" name="keyword">
                                            <option value="">Select Keywords</option>
                                            <option value="urgently hiring">urgently hiring</option>
                                            <option value="hiring multiple candidates">hiring multiple candidates
                                            </option>
                                            <option value="bonus">bonus</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            <div class="container-fluid d-flex justify-content-left flex-column mb-4 mt-5">
                                <label for="more_keywords" class="mb-2">
                                    Add More Keywords
                                </label>
                                <textarea class="form-control searchbox mb-2" name="more_keywords" type="text"
                                    placeholder="Keywords(Separate Every Keyword with a comma ',' e.g. Bouns, Required)"></textarea>
                            </div>

                            <div class="container-fluid d-flex justify-content-left flex-column mb-4">
                                <label for="more_exclusions" class="mb-2">
                                    Add Exclusions
                                </label>
                                <textarea class="form-control searchbox mb-2" name="exclusives" type="text"
                                    placeholder="Exclude(Separate Every Exclusion with a comma ',' e.g. School, College)"></textarea>
                            </div>


                            <div class="search-button" onclick="sendRequest();">
                                <div>
                                    <button href="#" id="searchButton" style="border: 0px;">
                                        <span></span>
                                        <span></span>
                                        <span></span>
                                        <span></span>
                                        Search
                                    </button>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>

            </div>
            <div class="col-lg-7 right-main-cont rounded-right" style="text-align: left;">
                <div class="container-fluid mt-3 d-flex" style="justify-content: space-between;">
                    <h1>Results</h1>
                    <button class="Documents-btn mt-1" onclick="downloadCSV()">
                        <span class="folderContainer">
                            <svg class="fileBack" width="146" height="113" viewBox="0 0 146 113" fill="none"
                                xmlns="http://www.w3.org/2000/svg">
                                <path
                                    d="M0 4C0 1.79086 1.79086 0 4 0H50.3802C51.8285 0 53.2056 0.627965 54.1553 1.72142L64.3303 13.4371C65.2799 14.5306 66.657 15.1585 68.1053 15.1585H141.509C143.718 15.1585 145.509 16.9494 145.509 19.1585V109C145.509 111.209 143.718 113 141.509 113H3.99999C1.79085 113 0 111.209 0 109V4Z"
                                    fill="url(#paint0_linear_117_4)"></path>
                                <defs>
                                    <linearGradient id="paint0_linear_117_4" x1="0" y1="0" x2="72.93" y2="95.4804"
                                        gradientUnits="userSpaceOnUse">
                                        <stop stop-color="#8F88C2"></stop>
                                        <stop offset="1" stop-color="#5C52A2"></stop>
                                    </linearGradient>
                                </defs>
                            </svg>
                            <svg class="filePage" width="88" height="99" viewBox="0 0 88 99" fill="none"
                                xmlns="http://www.w3.org/2000/svg">
                                <rect width="88" height="99" fill="url(#paint0_linear_117_6)"></rect>
                                <defs>
                                    <linearGradient id="paint0_linear_117_6" x1="0" y1="0" x2="81" y2="160.5"
                                        gradientUnits="userSpaceOnUse">
                                        <stop stop-color="white"></stop>
                                        <stop offset="1" stop-color="#686868"></stop>
                                    </linearGradient>
                                </defs>
                            </svg>

                            <svg class="fileFront" width="160" height="79" viewBox="0 0 160 79" fill="none"
                                xmlns="http://www.w3.org/2000/svg">
                                <path
                                    d="M0.29306 12.2478C0.133905 9.38186 2.41499 6.97059 5.28537 6.97059H30.419H58.1902C59.5751 6.97059 60.9288 6.55982 62.0802 5.79025L68.977 1.18034C70.1283 0.410771 71.482 0 72.8669 0H77H155.462C157.87 0 159.733 2.1129 159.43 4.50232L150.443 75.5023C150.19 77.5013 148.489 79 146.474 79H7.78403C5.66106 79 3.9079 77.3415 3.79019 75.2218L0.29306 12.2478Z"
                                    fill="url(#paint0_linear_117_5)"></path>
                                <defs>
                                    <linearGradient id="paint0_linear_117_5" x1="38.7619" y1="8.71323" x2="66.9106"
                                        y2="82.8317" gradientUnits="userSpaceOnUse">
                                        <stop stop-color="#C3BBFF"></stop>
                                        <stop offset="1" stop-color="#51469A"></stop>
                                    </linearGradient>
                                </defs>
                            </svg>
                        </span>
                        <p class="text mt-3">Download CSV</p>
                    </button>
                </div>

                <div class="container-fluid table-cont mt-5 p-4" style="overflow: scroll;">

                    <table class="table table-striped" id="jobDetailsTable">
                        <thead>
                            <tr>
                                <th scope="col">Date Posted</th>
                                <th scope="col">Job Title</th>
                                <th scope="col"> Job Link</th>
                                <th scope="col">Company Name</th>
                                <th scope="col">Indeed Link</th>
                                <th scope="col">Location</th>
                                <th scope="col">Pay</th>
                                <th scope="col">Job Type</th>
                                <th scope="col">Experience Level</th>
                                <th scope="col">Education</th>
                            </tr>
                        </thead>
                        <tbody>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    <script>
        function setmaxRange(value) {
            document.getElementById("maximum_range").innerHTML = "$" + value
        }
        function setminRange(value) {
            document.getElementById("manimum_range").innerHTML = "$" + value
        }
        function showLoader() {
            document.getElementById("loaderContainer").style.display = "flex";
        }
        document.addEventListener("DOMContentLoaded", function () {
            var paySelect = document.querySelector('select[name="pay"]');
            var minPayInput = document.querySelector('input[name="minpay"]');

            function toggleMinPayInput() {
                minPayInput.disabled = !(paySelect.value === "hour" || paySelect.value === "year");
            }

            paySelect.addEventListener("change", toggleMinPayInput);

            toggleMinPayInput();
        });
    </script>

    <script>
        function populateData(job_details) {
            const table = document.getElementById('jobDetailsTable');
            while (table.rows.length > 1) {
                table.deleteRow(1);
            }
            job_details.forEach(job => {
                const row = table.insertRow();

                const postedAtCell = row.insertCell();
                const jobTitleCell = row.insertCell();
                const jobLinkCell = row.insertCell();
                const companynameCell = row.insertCell();
                const companyLocationCell = row.insertCell();
                const companyLocation = row.insertCell();
                const Pay = row.insertCell();
                const type = row.insertCell();
                const exp = row.insertCell();
                const education = row.insertCell();
                var company_link = document.createElement("a");
                company_link.href = job.company_link;
                company_link.target = "_blank";
                company_link.textContent = job.company_link;
                companyLocationCell.appendChild(company_link);

                var company_link = document.createElement("a");
                company_link.href = job.company_link;
                company_link.target = "_blank";
                company_link.textContent = job.company_link;
                companyLocationCell.appendChild(company_link);                

                postedAtCell.textContent = job.posted_at;
                jobTitleCell.textContent = job.job_title;
                companynameCell.textContent = job.company_name;
                companyLocation.textContent = job.company_location;
                type.textContent = job.job_type;
                Pay.textContent = job.job_salary;
                exp.textContent = job.job_exp_level;
                education.textContent = job.job_education_level;


            });

        }
        $(document).ready(function () {
            $('#stateSelect').select2({
                dropdownCssClass: "scrollable-dropdown"
            });
        });

        function sendRequest() {
            const form = document.querySelector('form');

            function handleSubmit(event) {
                event.preventDefault();

                const formData = new FormData(form);
                const jsonObject = {};
                formData.forEach(function (value, key) {
                    jsonObject[key] = value;
                });
                console.log(jsonObject);

                const url = 'http://127.0.0.1:8001/job_scrapper/';

                document.getElementById("loaderContainer").style.display = "flex";
                fetch(url, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': jsonObject["csrfmiddlewaretoken"]
                    },
                    body: JSON.stringify(jsonObject)
                })
                    .then(response => {
                        if (!response.ok) {
                            throw new Error('Network response was not ok');
                        }
                        return response.json();
                    })
                    .then(data => {
                        console.log('Success:', data);
                        populateData(data.job_details);
                        document.getElementById("loaderContainer").style.display = "none";
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        document.getElementById("loaderContainer").style.display = "none";
                    });


                form.removeEventListener('submit', handleSubmit);
            }

            form.addEventListener('submit', handleSubmit);
        }

    </script>

    <script>

        var x, i, j, l, ll, selElmnt, a, b, c;
        x = document.getElementsByClassName("custom-select");
        l = x.length;
        for (i = 0; i < l; i++) {
            selElmnt = x[i].getElementsByTagName("select")[0];
            ll = selElmnt.length;
            a = document.createElement("DIV");
            a.setAttribute("class", "select-selected");
            a.innerHTML = selElmnt.options[selElmnt.selectedIndex].innerHTML;
            x[i].appendChild(a);
            b = document.createElement("DIV");
            b.setAttribute("class", "select-items select-hide");
            for (j = 1; j < ll; j++) {
                c = document.createElement("DIV");
                c.innerHTML = selElmnt.options[j].innerHTML;
                c.addEventListener("click", function (e) {
                    var y, i, k, s, h, sl, yl;
                    s = this.parentNode.parentNode.getElementsByTagName("select")[0];
                    sl = s.length;
                    h = this.parentNode.previousSibling;
                    for (i = 0; i < sl; i++) {
                        if (s.options[i].innerHTML == this.innerHTML) {
                            s.selectedIndex = i;
                            h.innerHTML = this.innerHTML;
                            y = this.parentNode.getElementsByClassName("same-as-selected");
                            yl = y.length;
                            for (k = 0; k < yl; k++) {
                                y[k].removeAttribute("class");
                            }
                            this.setAttribute("class", "same-as-selected");
                            break;
                        }
                    }
                    h.click();
                });
                b.appendChild(c);
            }
            x[i].appendChild(b);
            a.addEventListener("click", function (e) {
                e.stopPropagation();
                closeAllSelect(this);
                this.nextSibling.classList.toggle("select-hide");
                this.classList.toggle("select-arrow-active");
            });
        }
        function closeAllSelect(elmnt) {
            var x, y, i, xl, yl, arrNo = [];
            x = document.getElementsByClassName("select-items");
            y = document.getElementsByClassName("select-selected");
            xl = x.length;
            yl = y.length;
            for (i = 0; i < yl; i++) {
                if (elmnt == y[i]) {
                    arrNo.push(i)
                } else {
                    y[i].classList.remove("select-arrow-active");
                }
            }
            for (i = 0; i < xl; i++) {
                if (arrNo.indexOf(i)) {
                    x[i].classList.add("select-hide");
                }
            }
        }
        document.addEventListener("click", closeAllSelect);
    </script>
    <script>
        function downloadCSV() {
            const jobTitleInput = document.getElementById('job_title_input');
            const jobTitle = jobTitleInput.value;
            const url = `/download-csv/${jobTitle}/`;
            fetch(url)
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    return response.blob();
                })
                .then(blob => {
                    const blobUrl = URL.createObjectURL(blob);
                    const link = document.createElement('a');
                    link.href = blobUrl;
                    link.download = `${jobTitle}.csv`;

                    link.click();
                    URL.revokeObjectURL(blobUrl);
                })
                .catch(error => {
                    console.error('Error downloading CSV:', error);
                });
        }
    </script>
</body>

</html>
